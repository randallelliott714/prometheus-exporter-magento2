name: run_as_root Quality Gate ðŸ¤“
on: [push]
jobs:
  unit-tests:
    name: "Unit Tests ðŸŽ‰"
    runs-on: ubuntu-latest
    container:
      image: 'registry.gitlab.com/run_as_root/quality_as_root/pipeline/magento2-community:2.3.4-php73'
      credentials:
        username: ${{ secrets.GITLAB_USERNAME }}
        password: ${{ secrets.GITLAB_PASSWORD }}
    steps:
      - name: Composer Cache
        uses: actions/cache@v2
        with:
          path: ~/.composer
          key: v1-composer-deps-${{ hashFiles('**/composer-lock.json') }}
          restore-keys: v1-composer-deps-
      - name: Checkout Repository
        uses: actions/checkout@v2
      - name: Get Composer
        run: |
                pwd
                ls -lah
                ls -lah /application
                php -v
                composer install
                docker-php-ext-enable xdebug


      - name: Run Unit Tests
        run: docker-php-ext-enable xdebug


  codestyle:
    name: "Code Style ðŸ¤¡"
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2
      - name: Get Composer
        uses: php-actions/composer@v5
      - name: Install PHP CS
        run: composer install --prefer-dist --working-dir=build/tools
      - name: Run PHP Code Style
        run: build/tools/vendor/bin/phpcs --standard=phpcs-ruleset.xml src/ --ignore-annotations