name: Quality Gate ðŸ¤“
on: [push]
jobs:
  login:
    name: "GitLab Login ðŸ”’"
    runs-on: ubuntu-latest
    steps:
      - name: Login to GitLab
        uses: docker/login-action@v1
        with:
          registry: registry.gitlab.com
          username: ${{ secrets.GITLAB_USERNAME }}
          password: ${{ secrets.GITLAB_PASSWORD }}
  unit-tests:
    name: "Unit Tests ðŸŽ‰"
    runs-on: ubuntu-latest
    container: registry.gitlab.com/mwltr/dev-setup/docker-base-images/mwltr-magento2-os:2.3-php73
    steps:
      - name: Composer Cache
        uses: actions/cache@v2
        with:
          path: ~/.composer
          key: v1-composer-deps-${{ hashFiles('**/composer-lock.json') }}
          restore-keys: v1-composer-deps-
      - name: Checkout Repository
        uses: actions/checkout@v2
      - name: Get Composer
        uses: php-actions/composer@v5
      - run: docker-php-ext-enable xdebug

  codestyle:
    name: "Code Style ðŸ¤¡"
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2
      - name: Get Composer
        uses: php-actions/composer@v5
      - name: Install PHP CS
        run: composer install --prefer-dist --working-dir=build/tools
      - name: Run PHP Code Style
        run: build/tools/vendor/bin/phpcs --standard=phpcs-ruleset.xml src/ --ignore-annotations